# dbt clone

## Overview

`dbt clone` creates zero-copy clones of database objects from a source environment (typically production) to a target environment. This enables fast environment setup without data copying, using database-native cloning features.

**Reference**: https://docs.getdbt.com/reference/commands/clone

## Task Class: `CloneTask`

`CloneTask` extends `GraphRunnableTask` and uses database cloning instead of materialization.

## Implementation Quirks

### Always Requires State

Unlike other commands where `--defer` and `--state` are optional, clone always requires knowing where to clone from.

### Independent Execution Mode

Clone uses `GraphRunnableMode.Independent`, which means nodes are run without topological ordering.

This is because clones don't depend on each otherâ€”they all reference the source environment.

### No Compilation

`CloneRunner.compile()` is a no-op since there's no SQL to compile!

### Clone Materialization Macro

Cloning is handled by the `clone` materialization macro.

The macro calls adapter-specific clone methods (e.g., `CREATE TABLE ... CLONE` on Snowflake).

### Schema Caching

Clone caches both target and source (defer_relation) schemas.

### Refable Node Types Only

Clone only works with "refable" nodes (models, seeds, snapshots).

## Flags

| Flag | Description |
|------|-------------|
| `--select` | Select nodes to clone |
| `--exclude` | Exclude nodes |
| `--state` | Path to production manifest (required) |
| `--resource-type` | Filter by type (model, seed, snapshot) |
| `--full-refresh` | Re-clone even if target exists |

## Database Support

Clone support varies by adapter:

| Adapter | Clone Method |
|---------|--------------|
| Snowflake | `CREATE TABLE ... CLONE` |
| BigQuery | Table copy/clone |
| Databricks | Delta Lake shallow clone |
| Others | Falls back to `CREATE TABLE AS SELECT` |

## Use Cases

1. **Dev Environment Setup**: Clone production to development instantly
2. **CI Environments**: Create isolated test environments
3. **Blue/Green Deployment**: Clone before schema migrations
4. **Data Sampling**: Clone structure without full data

## Example

```bash
# Clone production models to development
dbt clone --select tag:core --state prod-artifacts/

# Clone with full refresh
dbt clone --select my_model --state prod-artifacts/ --full-refresh
```
