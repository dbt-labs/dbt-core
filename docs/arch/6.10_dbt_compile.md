# dbt compile

## Overview

`dbt compile` generates executable SQL from Jinja templates without executing anything against the database. Compiled SQL files are written to the `target/compiled/` directory.

**Reference**: https://docs.getdbt.com/reference/commands/compile

## Task Class: `CompileTask`

`CompileTask` extends `GraphRunnableTask` and is the base class for many execution commands (`RunTask`, `TestTask`, `ShowTask`, etc.).

### CompileRunner

`CompileRunner` extends `BaseRunner` and handles the compilation step without execution:

```python
class CompileRunner(BaseRunner):
    def compile(self, manifest):
        return self.compiler.compile_node(self.node, manifest, {})
    
    def execute(self, compiled_node, manifest):
        # For pure compilation, just return success
        return RunResult(node=compiled_node, status=RunStatus.Success, ...)
```

## Implementation Quirks

### `--inline` Support

`CompileTask` supports inline SQL compilation via `--inline`. After compilation, the inline node is removed from the manifest.

### Compiled SQL Location

Compiled files are written to `target/compiled/{project_name}/{path}`:

```
target/
  compiled/
    my_project/
      models/
        marts/
          orders.sql    # Compiled SQL (refs resolved)
      tests/
        unique_orders_id.sql
```

### `--introspect` Flag

Controls whether to run introspective queries (e.g., fetching column types). It is enabled by default.

```python
if self.args.introspect:
    # Allow adapter queries during compilation
```

### Ephemeral CTE Injection

When `--inject-ephemeral-ctes` is enabled, ephemeral model CTEs are inlined into the compiled SQL. This is enabled by default.

### Output Formats

The `--output` flag controls how compiled SQL is displayed:

| Value | Description |
|-------|-------------|
| `text` | Plain SQL text |
| `json` | JSON with node metadata |

## Flags

| Flag | Description |
|------|-------------|
| `--select` | Compile selected nodes |
| `--inline` | Compile inline SQL string |
| `--output` | Output format: `text` or `json` |
| `--introspect` / `--no-introspect` | Enable/disable adapter queries |
| `--inject-ephemeral-ctes` | Inline ephemeral model CTEs |

## Examples

```bash
# Compile all models
dbt compile

# Compile specific model
dbt compile --select my_model

# Compile inline SQL
dbt compile --inline "select * from {{ ref('orders') }}"

# Output as JSON
dbt compile --select my_model --output json
```

## Use Cases

1. **Preview SQL**: See exactly what SQL will run
2. **Debug Jinja**: Verify template rendering
3. **IDE Integration**: Generate SQL for external tools
4. **CI Validation**: Ensure models compile without database access
