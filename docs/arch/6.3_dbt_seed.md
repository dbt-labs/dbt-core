# dbt seed

## Overview

`dbt seed` loads CSV files from the `seeds/` (or configured `seeds-dir` in dbt_project.yml) directory into the data warehouse as tables. Seeds are useful for small lookup tables, test fixtures, or static reference data.

**Reference**: https://docs.getdbt.com/reference/commands/seed

## Task Class: `SeedTask`

`SeedTask` extends `RunTask` but filters to only `NodeType.Seed` resources:

```python
class SeedTask(RunTask):
    def get_node_selector(self):
        return ResourceTypeSelector(
            resource_types=[NodeType.Seed],
            ...
        )
```

### SeedRunner

`SeedRunner` extends `ModelRunner` but with key differences:

1. **No Compilation**: `compile()` returns the node unchanged—no Jinja rendering
2. **Agate Table Result**: Returns the loaded agate table in the result for `--show` output

```python
def compile(self, manifest: Manifest):
    return self.node  # No Jinja compilation for seeds

def _build_run_model_result(self, model, context):
    result = super()._build_run_model_result(model, context)
    result.agate_table = context["load_result"]("agate_table").table
    return result
```

## Implementation Quirks

### CSV Loading

Seed CSV files are discovered during manifest loading, but the CSV content is **not** loaded during parsing. The `SeedParser` creates a `SeedNode` with file metadata (path, name, config) but explicitly skips content loading—the `render_with_context()` method is a no-op for seeds.

The actual CSV loading happens at **runtime** via `load_agate_table()` (`core/dbt/context/providers.py`), which is called from the `seed` materialization macro. The adapter then handles bulk insert to the database.

The CSV is loaded into memory as an agate table via `load_agate_table()` in the Jinja context.

### Large CSV Handling

Seeds over **1 MB** (`MAXIMUM_SEED_SIZE`) receive special handling for partial parsing:

```python
# core/dbt/constants.py
MAXIMUM_SEED_SIZE = 1 * 1024 * 1024  # 1 MB
```

For large seeds:
- **No content hashing**: Instead of hashing file contents, dbt uses the file path as the checksum (`FileHash.path()`). This avoids reading the entire file into memory during parsing.
- **Change detection limitations**: Since content isn't hashed, dbt cannot reliably detect changes. It uses heuristics based on file path.

**Warning messages for large seeds:**
- `SeedIncreased`: Seed grew past 1MB threshold
- `SeedExceedsLimitSamePath`: Large seed at same path, assuming unchanged
- `SeedExceedsLimitAndPathChanged`: Large seed moved, assuming changed

### `--show` Flag

The `--show` flag displays a random sample of each loaded seed:

### Error Handling

`raise_on_first_error()` returns `False`, so seed loading continues even if individual seed nodes fail.

## Flags

| Flag | Description |
|------|-------------|
| `--select` | Select specific seeds to load |
| `--show` | Display random sample of loaded data |
