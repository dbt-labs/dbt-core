# Data Freshness Management

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [.changes/unreleased/Features-20250623-113130.yaml](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Features-20250623-113130.yaml)
- [.changes/unreleased/Fixes-20250530-005804.yaml](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250530-005804.yaml)
- [.changes/unreleased/Fixes-20250605-110645.yaml](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250605-110645.yaml)
- [.changes/unreleased/Fixes-20250609-175239.yaml](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250609-175239.yaml)
- [.changes/unreleased/Fixes-20250610-211241.yaml](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250610-211241.yaml)
- [.changes/unreleased/Fixes-20250616-085600.yaml](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250616-085600.yaml)

</details>



The Data Freshness Management system in dbt-core provides functionality for tracking and validating the recency of data in both source tables and derived models. This system enables users to configure freshness checks that monitor when data was last loaded or updated, ensuring data quality and timeliness in data pipelines.

For information about configuration validation and JSON schema processing, see [Configuration Validation and JSON Schema](#3.1). For project-level configuration management, see [Project Configuration and Schema](#5.1).

## System Overview

The freshness management system operates on two primary entities: source tables and models. It supports configurable freshness checks through `loaded_at_query` and `loaded_at_field` configurations, allowing flexible monitoring strategies for different data patterns.

```mermaid
graph TB
    subgraph "Freshness Management Core"
        SFS["SourceFreshnessSystem"]
        MFS["ModelFreshnessSystem"] 
        FCC["FreshnessConfigController"]
    end
    
    subgraph "Configuration Sources"
        SC["source_config"]
        TC["table_config"]
        MC["model_config"]
        PYC["project_yml_config"]
    end
    
    subgraph "Freshness Queries"
        LAQ["loaded_at_query"]
        LAF["loaded_at_field"]
        BAF["build_after_field"]
    end
    
    subgraph "Validation Layer"
        FCV["FreshnessConfigValidator"]
        NPV["NullParsingValidator"]
        ICV["InlineConfigValidator"]
    end
    
    SC --> SFS
    TC --> SFS
    MC --> MFS
    PYC --> FCC
    
    SFS --> LAQ
    SFS --> LAF
    MFS --> LAQ
    MFS --> BAF
    
    FCC --> FCV
    FCV --> NPV
    FCV --> ICV
    
    SFS --> FCV
    MFS --> FCV
```

Sources: [.changes/unreleased/Features-20250623-113130.yaml:1-7](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Features-20250623-113130.yaml#L1-L7), [.changes/unreleased/Fixes-20250530-005804.yaml:1-7](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250530-005804.yaml#L1-L7)

## Source Freshness Management

Source freshness tracking monitors the recency of data in external source tables. The system supports configuration through both `loaded_at_query` and `loaded_at_field` options, providing flexibility for different source table schemas and data loading patterns.

### Source Configuration Processing

The source freshness system processes configurations from multiple levels, with proper handling of explicit null values and configuration inheritance.

```mermaid
graph LR
    subgraph "Source Node Processing"
        SN["SourceNode"]
        SF["source.freshness"]
        SCF["source.config.freshness"]
    end
    
    subgraph "Configuration Resolution"
        CR["ConfigResolver"]
        NH["NullHandler"]
        CI["ConfigInheritance"]
    end
    
    subgraph "Freshness Execution"
        FE["FreshnessExecutor"]
        QG["QueryGenerator"]
        FC["FreshnessChecker"]
    end
    
    SN --> SF
    SN --> SCF
    SF --> CR
    SCF --> CR
    
    CR --> NH
    CR --> CI
    NH --> FE
    CI --> FE
    
    FE --> QG
    FE --> FC
```

The system ensures that `source.freshness` equals `source.config.freshness` for consistency across the node representation.

Sources: [.changes/unreleased/Fixes-20250530-005804.yaml:1-7](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250530-005804.yaml#L1-L7), [.changes/unreleased/Fixes-20250609-175239.yaml:1-7](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250609-175239.yaml#L1-L7)

## Model Freshness Management

Model freshness tracking monitors the recency of derived models and materialized tables. This system has undergone recent architectural changes to standardize configuration handling and improve validation.

### Model Freshness Configuration Evolution

Recent changes have moved model freshness configuration from property-level to config-level support, providing better consistency with the overall dbt configuration system.

```mermaid
graph TB
    subgraph "Legacy System (Deprecated)"
        MFP["model_freshness_property"]
        PLS["property_level_support"]
    end
    
    subgraph "Current System"
        MFC["model_freshness_config"]
        CLS["config_level_support"]
        ICV["inline_config_validation"]
    end
    
    subgraph "Parsing Layer"
        MFP_PARSER["ModelFreshnessPropertyParser"]
        MFC_PARSER["ModelFreshnessConfigParser"]
        BAP["build_after_presence_check"]
    end
    
    subgraph "Validation Rules"
        VR["ValidationRules"]
        ICC["invalid_config_check"]
        SFD["skip_freshness_definition"]
    end
    
    MFP -.-> MFC
    PLS -.-> CLS
    
    MFC --> MFC_PARSER
    MFC_PARSER --> BAP
    MFC_PARSER --> ICV
    
    BAP --> VR
    ICV --> VR
    VR --> ICC
    VR --> SFD
```

The parsing system now ensures that `build_after` is present in model freshness definitions, otherwise it skips the freshness definition entirely.

Sources: [.changes/unreleased/Fixes-20250605-110645.yaml:1-8](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250605-110645.yaml#L1-L8), [.changes/unreleased/Fixes-20250616-085600.yaml:1-7](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250616-085600.yaml#L1-L7), [.changes/unreleased/Fixes-20250610-211241.yaml:1-7](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250610-211241.yaml#L1-L7)

## Configuration System Architecture

The freshness management system integrates with dbt-core's hierarchical configuration system, supporting both source and table-level configuration inheritance.

### Configuration Hierarchy

| Configuration Level | Source Freshness | Model Freshness | Table Freshness |
|-------------------|------------------|-----------------|-----------------|
| Project Level | âœ“ | âœ“ | âœ“ |
| Source Level | âœ“ | - | - |
| Model Level | - | âœ“ | - |
| Table Level | - | - | âœ“ |
| Inline Config | - | âœ“ | âœ“ |

### Supported Configuration Parameters

The system supports the following freshness configuration parameters across different entity types:

```mermaid
graph LR
    subgraph "Freshness Config Parameters"
        LAQ["loaded_at_query"]
        LAF["loaded_at_field"]
        WI["warn_after"]
        EI["error_after"]
        BA["build_after"]
    end
    
    subgraph "Source Support"
        S_LAQ["source.loaded_at_query"]
        S_LAF["source.loaded_at_field"]
        S_WI["source.warn_after"]
        S_EI["source.error_after"]
    end
    
    subgraph "Table Support"
        T_LAQ["table.loaded_at_query"]
        T_LAF["table.loaded_at_field"]
        T_WI["table.warn_after"]
        T_EI["table.error_after"]
    end
    
    subgraph "Model Support"
        M_LAQ["model.loaded_at_query"]
        M_LAF["model.loaded_at_field"]
        M_BA["model.build_after"]
    end
    
    LAQ --> S_LAQ
    LAQ --> T_LAQ
    LAQ --> M_LAQ
    
    LAF --> S_LAF
    LAF --> T_LAF
    LAF --> M_LAF
    
    WI --> S_WI
    WI --> T_WI
    
    EI --> S_EI
    EI --> T_EI
    
    BA --> M_BA
```

Sources: [.changes/unreleased/Features-20250623-113130.yaml:1-7](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Features-20250623-113130.yaml#L1-L7)

## Validation and Error Handling

The freshness management system includes robust validation and error handling mechanisms to ensure configuration correctness and provide clear feedback for invalid configurations.

### Validation Pipeline

```mermaid
graph TB
    subgraph "Input Validation"
        CV["ConfigValidator"]
        NV["NullValidator"]
        TV["TypeValidator"]
    end
    
    subgraph "Business Logic Validation"
        BLV["BusinessLogicValidator"]
        BAV["BuildAfterValidator"]
        FDV["FreshnessDefinitionValidator"]
    end
    
    subgraph "Error Handling"
        EH["ErrorHandler"]
        ICI["InvalidConfigIgnore"]
        SFD["SkipFreshnessDefinition"]
        VE["ValidationError"]
    end
    
    CV --> BLV
    NV --> BLV
    TV --> BLV
    
    BLV --> BAV
    BLV --> FDV
    
    BAV --> EH
    FDV --> EH
    
    EH --> ICI
    EH --> SFD
    EH --> VE
```

The validation system handles several key scenarios:
- Explicit null handling in source freshness configurations
- Missing `build_after` fields in model freshness definitions
- Invalid inline model configuration validation
- Configuration consistency checks between node properties and config objects

Sources: [.changes/unreleased/Fixes-20250530-005804.yaml:1-7](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250530-005804.yaml#L1-L7), [.changes/unreleased/Fixes-20250605-110645.yaml:1-8](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250605-110645.yaml#L1-L8), [.changes/unreleased/Fixes-20250610-211241.yaml:1-7](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250610-211241.yaml#L1-L7), [.changes/unreleased/Fixes-20250609-175239.yaml:1-7](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250609-175239.yaml#L1-L7)

## Recent System Improvements

The freshness management system has undergone significant improvements to enhance reliability and standardize configuration handling:

### Key Enhancements

1. **Extended Configuration Support**: Added `loaded_at_query` and `loaded_at_field` support for both source and table configurations, providing greater flexibility in freshness monitoring strategies.

2. **Improved Null Handling**: Enhanced the system's ability to handle explicit null values in source freshness configurations, preventing configuration resolution errors.

3. **Standardized Model Configuration**: Moved from property-level to config-level support for model freshness, aligning with dbt-core's configuration patterns and improving consistency.

4. **Enhanced Validation**: Implemented stricter validation rules for model freshness definitions, ensuring required fields are present before processing.

5. **Configuration Consistency**: Established consistency between node freshness properties and configuration objects, eliminating discrepancies in node representation.