# Project Configuration and Schema

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [.changes/unreleased/Features-20250529-085311.yaml](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Features-20250529-085311.yaml)
- [.changes/unreleased/Features-20250617-142516.yaml](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Features-20250617-142516.yaml)
- [.changes/unreleased/Features-20250623-113130.yaml](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Features-20250623-113130.yaml)

</details>



## Purpose and Scope

This document covers dbt-core's project-level configuration management system, focusing on the `dbt_project.yml` schema validation, catalog integration configurations, and the underlying JSON schema framework that validates project configurations. This includes the schema definitions for data test properties, exposure configurations, and source/table-level settings.

For information about hierarchical configuration parsing and nested configuration management, see [Hierarchical Configuration Parsing](#5.2). For CLI-level configuration handling, see [Command Interface and Deprecations](#4.1).

## dbt_project.yml Schema System Overview

The dbt project configuration system centers around the `dbt_project.yml` file, which serves as the primary configuration entry point for dbt projects. The system uses JSON schema validation to ensure configuration correctness and provides structured configuration parsing.

```mermaid
graph TB
    subgraph "Configuration Entry Points"
        dbt_project["dbt_project.yml"]
        model_configs["Model Configurations"]
        source_configs["Source Configurations"] 
        table_configs["Table Configurations"]
    end
    
    subgraph "Schema Validation Layer"
        json_validator["JSON Schema Validator"]
        builtin_schemas["Builtin Schema Definitions"]
        data_test_schema["Data Test Properties Schema"]
        exposure_schema["Exposure Config Schema"]
    end
    
    subgraph "Configuration Processing"
        config_parser["Configuration Parser"]
        catalog_integration["Catalog Integration Config"]
        freshness_config["Freshness Configuration"]
    end
    
    subgraph "Validation Output"
        validated_config["Validated Configuration"]
        deprecation_warnings["Deprecation Warnings"]
        schema_errors["Schema Validation Errors"]
    end
    
    dbt_project --> json_validator
    model_configs --> json_validator  
    source_configs --> json_validator
    table_configs --> json_validator
    
    json_validator --> builtin_schemas
    json_validator --> data_test_schema
    json_validator --> exposure_schema
    
    builtin_schemas --> config_parser
    data_test_schema --> config_parser
    exposure_schema --> config_parser
    
    config_parser --> catalog_integration
    config_parser --> freshness_config
    
    config_parser --> validated_config
    json_validator --> deprecation_warnings
    json_validator --> schema_errors
```

Sources: `.changes/unreleased/Features-20250617-142516.yaml`

## JSON Schema Validation Framework

The configuration validation system relies on JSON schemas to enforce structure and data types for various configuration sections. This framework has been enhanced to include builtin data test properties and exposure configurations directly in the `dbt_project.yml` schema definitions.

### Schema Validation Components

| Component | Purpose | Key Features |
|-----------|---------|--------------|
| **JSON Schema Validator** | Core validation engine | Type checking, required fields, format validation |
| **Builtin Data Test Properties** | Validates test configurations | Supports standard dbt test properties |
| **Exposure Config Schema** | Validates exposure definitions | Ensures proper exposure configuration structure |
| **Deprecation Detection** | Identifies deprecated configurations | Provides migration guidance |

```mermaid
graph LR
    subgraph "Schema Definitions"
        project_schema["dbt_project.yml Schema"]
        test_properties["Data Test Properties"]
        exposure_config["Exposure Configurations"]
        source_schema["Source Schema"]
    end
    
    subgraph "Validation Process"
        schema_loader["Schema Loader"]
        validator["JSON Validator"]
        deprecation_checker["Deprecation Checker"]
    end
    
    subgraph "Configuration Types"
        builtin_tests["Builtin Test Configs"]
        custom_tests["Custom Test Configs"]
        exposure_defs["Exposure Definitions"]
        catalog_configs["Catalog Integration Configs"]
    end
    
    project_schema --> schema_loader
    test_properties --> schema_loader
    exposure_config --> schema_loader
    source_schema --> schema_loader
    
    schema_loader --> validator
    validator --> deprecation_checker
    
    validator --> builtin_tests
    validator --> custom_tests
    validator --> exposure_defs
    validator --> catalog_configs
```

Sources: `.changes/unreleased/Features-20250617-142516.yaml`

## Catalog Integration Configuration

The catalog integration system has been extended to support additional configuration options, including file format specifications. This allows dbt to better integrate with various catalog systems and data discovery tools.

### Catalog Configuration Properties

The catalog integration configuration includes:

- **File Format Configuration**: Specifies the format for catalog output files
- **Integration Settings**: Controls how dbt interacts with external catalog systems  
- **Output Formatting**: Manages the structure and format of catalog data

```mermaid
graph TD
    subgraph "Catalog Configuration"
        file_format["file_format Property"]
        integration_config["Integration Config"]
        output_settings["Output Settings"]
    end
    
    subgraph "Catalog Processing"
        catalog_generator["Catalog Generator"]
        format_handler["Format Handler"]
        integration_manager["Integration Manager"]
    end
    
    subgraph "Output Formats"
        json_format["JSON Format"]
        yaml_format["YAML Format"] 
        csv_format["CSV Format"]
        custom_format["Custom Format"]
    end
    
    file_format --> catalog_generator
    integration_config --> catalog_generator
    output_settings --> catalog_generator
    
    catalog_generator --> format_handler
    catalog_generator --> integration_manager
    
    format_handler --> json_format
    format_handler --> yaml_format
    format_handler --> csv_format  
    format_handler --> custom_format
```

Sources: `.changes/unreleased/Features-20250529-085311.yaml`

## Source and Table Configuration Properties

The configuration system supports freshness tracking properties at both source and table levels. This includes `loaded_at_query` and `loaded_at_field` configurations that enable dbt to determine data freshness automatically.

### Freshness Configuration Structure

| Configuration | Level | Purpose | Example Use Case |
|---------------|-------|---------|------------------|
| `loaded_at_query` | Source/Table | Custom SQL query to determine load time | Complex timestamp logic |
| `loaded_at_field` | Source/Table | Field name containing load timestamp | Simple timestamp column |
| **Freshness Thresholds** | Source/Table | Warning and error thresholds | SLA monitoring |
| **Freshness Filters** | Source/Table | Additional filtering conditions | Conditional freshness checks |

```mermaid
graph TB
    subgraph "Configuration Sources"
        source_yml["sources.yml"]
        dbt_project_yml["dbt_project.yml"]
        table_properties["Table Properties"]
    end
    
    subgraph "Freshness Properties"
        loaded_at_query["loaded_at_query"]
        loaded_at_field["loaded_at_field"]
        freshness_thresholds["Freshness Thresholds"]
        freshness_filters["Freshness Filters"]
    end
    
    subgraph "Processing Components"
        freshness_parser["Freshness Parser"]
        query_builder["Query Builder"]  
        threshold_validator["Threshold Validator"]
    end
    
    subgraph "Runtime Execution"
        freshness_check["Freshness Check Execution"]
        timestamp_extraction["Timestamp Extraction"]
        sla_monitoring["SLA Monitoring"]
    end
    
    source_yml --> loaded_at_query
    source_yml --> loaded_at_field
    dbt_project_yml --> freshness_thresholds
    table_properties --> freshness_filters
    
    loaded_at_query --> freshness_parser
    loaded_at_field --> freshness_parser
    freshness_thresholds --> threshold_validator
    freshness_filters --> freshness_parser
    
    freshness_parser --> query_builder
    threshold_validator --> freshness_check
    query_builder --> timestamp_extraction
    freshness_check --> sla_monitoring
```

Sources: `.changes/unreleased/Features-20250623-113130.yaml`

## Data Test and Exposure Configuration Schema

The schema validation system includes comprehensive support for data test properties and exposure configurations within the `dbt_project.yml` file. This enables more accurate deprecation warnings and better configuration validation.

### Configuration Validation Flow

The validation process ensures that both builtin and custom configurations conform to expected schemas:

1. **Schema Loading**: Load appropriate schema definitions for the configuration type
2. **Property Validation**: Validate individual properties against their schema definitions  
3. **Deprecation Checking**: Identify deprecated configuration patterns
4. **Error Reporting**: Provide detailed validation error messages

```mermaid
graph LR
    subgraph "Test Configuration"
        builtin_tests["Builtin Data Tests"]
        custom_tests["Custom Data Tests"] 
        test_properties["Test Properties"]
    end
    
    subgraph "Exposure Configuration"
        exposure_definitions["Exposure Definitions"]
        exposure_properties["Exposure Properties"]
        exposure_meta["Exposure Metadata"]
    end
    
    subgraph "Validation Engine"
        property_validator["Property Validator"]
        schema_matcher["Schema Matcher"]
        deprecation_detector["Deprecation Detector"]
    end
    
    subgraph "Validation Results"
        valid_config["Valid Configuration"]
        deprecation_warnings["Deprecation Warnings"]
        validation_errors["Validation Errors"]
    end
    
    builtin_tests --> property_validator
    custom_tests --> property_validator
    test_properties --> property_validator
    
    exposure_definitions --> schema_matcher
    exposure_properties --> schema_matcher
    exposure_meta --> schema_matcher
    
    property_validator --> deprecation_detector
    schema_matcher --> deprecation_detector
    
    deprecation_detector --> valid_config
    deprecation_detector --> deprecation_warnings
    property_validator --> validation_errors
    schema_matcher --> validation_errors
```