# Configuration Validation and JSON Schema

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [.changes/unreleased/Features-20250714-232524.yaml](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Features-20250714-232524.yaml)
- [.changes/unreleased/Fixes-20250707-103418.yaml](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250707-103418.yaml)
- [.changes/unreleased/Fixes-20250710-170148.yaml](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/unreleased/Fixes-20250710-170148.yaml)

</details>



This document covers dbt-core's JSON schema validation system, which provides structured validation for project configurations, model definitions, and other dbt artifacts. The system includes adapter-specific validation gating, schema definition management, and deprecation handling for configuration validation processes.

For information about hierarchical configuration parsing and project-level settings, see [Hierarchical Configuration Parsing](#5.2). For model-specific configuration processing, see [Model Configuration Processing](#3.2).

## Purpose and Scope

The Configuration Validation and JSON Schema system serves as the validation layer for dbt project configurations, ensuring that YAML configurations, SQL model configurations, and other project artifacts conform to expected schemas. The system provides:

- JSON schema-based validation for multiple configuration types
- Adapter-specific validation gating to customize validation behavior
- Deprecation management for evolving configuration standards
- Integration with the broader project parsing pipeline

## System Architecture

**Configuration Validation System Architecture**

```mermaid
graph TB
    subgraph ConfigSources["Configuration Sources"]
        dbtProject["dbt_project.yml"]
        modelSQL["Model SQL Files"]
        sourceYAML["Source YAML Files"]
        tableConfigs["Table Configurations"]
    end
    
    subgraph ValidationCore["Validation Core"]
        jsonSchemaValidator["JSON Schema Validator"]
        adapterGate["Adapter-Specific Gate"]
        deprecationHandler["GenericJSONSchemaValidationDeprecation"]
    end
    
    subgraph SchemaRules["Schema Rules"]
        dataTestProps["Data Test Properties"]
        exposureConfigs["Exposure Configurations"]
        freshnessConfigs["Freshness Configurations"]
        loadedAtConfigs["loaded_at Configurations"]
    end
    
    subgraph ProcessingSystems["Processing Systems"]
        modelProcessor["Model Processing"]
        sourceProcessor["Source Processing"]
        testProcessor["Test Processing"]
    end
    
    dbtProject --> jsonSchemaValidator
    modelSQL --> jsonSchemaValidator
    sourceYAML --> jsonSchemaValidator
    tableConfigs --> jsonSchemaValidator
    
    jsonSchemaValidator --> adapterGate
    adapterGate --> deprecationHandler
    
    jsonSchemaValidator --> dataTestProps
    jsonSchemaValidator --> exposureConfigs
    jsonSchemaValidator --> freshnessConfigs
    jsonSchemaValidator --> loadedAtConfigs
    
    dataTestProps --> modelProcessor
    dataTestProps --> testProcessor
    freshnessConfigs --> sourceProcessor
    loadedAtConfigs --> sourceProcessor
    loadedAtConfigs --> modelProcessor
    
    deprecationHandler -.-> modelProcessor
    deprecationHandler -.-> sourceProcessor
    deprecationHandler -.-> testProcessor
```

Sources: Based on architecture diagrams and change file patterns from `.changes/unreleased/Features-20250714-232524.yaml`, `.changes/unreleased/Fixes-20250707-103418.yaml`

## Core Validation Components

### JSON Schema Validator

The JSON Schema Validator serves as the primary validation engine for dbt configurations. This component processes various configuration sources and applies appropriate schema validation rules.

**Validation Flow**

```mermaid
flowchart TD
    configInput["Configuration Input"]
    schemaLoad["Load JSON Schema"]
    validate["Validate Against Schema"]
    adapterCheck["Check Adapter Compatibility"]
    errorHandle["Handle Validation Errors"]
    success["Validation Success"]
    
    configInput --> schemaLoad
    schemaLoad --> validate
    validate --> adapterCheck
    adapterCheck -->|"Valid"| success
    adapterCheck -->|"Invalid"| errorHandle
    validate -->|"Schema Error"| errorHandle
```

The validator handles multiple configuration types including:
- Project-level configurations from `dbt_project.yml`
- Model SQL configurations embedded in SQL files
- Source and table configuration definitions
- Test and exposure configurations

Sources: `.changes/unreleased/Features-20250714-232524.yaml`, `.changes/unreleased/Fixes-20250707-103418.yaml`

### Adapter-Specific Validation Gating

The system implements adapter-specific validation gating to customize validation behavior based on the target database adapter. This allows different adapters to have different validation requirements.

| Component | Purpose | Gating Behavior |
|-----------|---------|----------------|
| `adapterGate` | Controls validation scope | Enables/disables validations per adapter |
| `jsonSchemaValidator` | Core validation logic | Respects adapter gating decisions |
| Configuration processors | Apply validated configs | Receive adapter-filtered results |

**Adapter Gating Process**

```mermaid
stateDiagram-v2
    [*] --> ConfigurationInput
    ConfigurationInput --> AdapterDetection
    AdapterDetection --> GateEvaluation
    
    state GateEvaluation {
        [*] --> CheckAdapterRules
        CheckAdapterRules --> ValidationEnabled
        CheckAdapterRules --> ValidationSkipped
    }
    
    ValidationEnabled --> JSONSchemaValidation
    ValidationSkipped --> DirectPass
    JSONSchemaValidation --> ConfigurationOutput
    DirectPass --> ConfigurationOutput
    ConfigurationOutput --> [*]
```

Sources: `.changes/unreleased/Features-20250714-232524.yaml`

### Deprecation Management

The `GenericJSONSchemaValidationDeprecation` component manages the deprecation of configuration validation features, providing controlled migration paths for evolving validation standards.

Key aspects of deprecation management:
- Preview deprecation status for gradual migration
- Warning generation for deprecated validation patterns
- Compatibility maintenance during transition periods

Sources: `.changes/unreleased/Fixes-20250710-170148.yaml`

## Configuration Sources and Processing

### Configuration Input Types

The validation system processes multiple types of configuration inputs:

**Configuration Source Mapping**

```mermaid
graph LR
    subgraph ProjectLevel["Project Level"]
        dbtProjectYml["dbt_project.yml"]
        globalConfigs["Global Configurations"]
    end
    
    subgraph ModelLevel["Model Level"]
        modelSqlConfigs["SQL Model Configs"]
        modelYamlConfigs["Model YAML Configs"]
    end
    
    subgraph SourceLevel["Source Level"]
        sourceConfigurations["Source Configurations"]
        tableConfigurations["Table Configurations"]
    end
    
    subgraph TestLevel["Test Level"]
        testProperties["Test Properties"]
        dataTestConfigs["Data Test Configs"]
    end
    
    dbtProjectYml --> ValidationPipeline["Validation Pipeline"]
    globalConfigs --> ValidationPipeline
    modelSqlConfigs --> ValidationPipeline
    modelYamlConfigs --> ValidationPipeline
    sourceConfigurations --> ValidationPipeline
    tableConfigurations --> ValidationPipeline
    testProperties --> ValidationPipeline
    dataTestConfigs --> ValidationPipeline
```

### Schema Definition Updates

Recent updates to the schema definitions include:
- Nested configuration definitions for complex configuration structures
- Cloud integration information handling
- Removal of deprecated source override configurations

Sources: `.changes/unreleased/Fixes-20250707-103418.yaml`

## Validation Rules and Processing

### Rule Categories

The system applies different validation rules based on configuration type:

| Rule Category | Configuration Target | Validation Focus |
|---------------|---------------------|------------------|
| Data Test Properties | Model and source tests | Test argument validation |
| Exposure Configurations | Exposure definitions | Exposure metadata validation |
| Freshness Configurations | Source freshness settings | Freshness parameter validation |
| loaded_at Configurations | Source and model loading | Loading timestamp validation |

### Processing Integration

**Validation to Processing Flow**

```mermaid
graph TD
    subgraph ValidationResults["Validation Results"]
        validatedDataTests["Validated Data Tests"]
        validatedExposures["Validated Exposures"]
        validatedFreshness["Validated Freshness"]
        validatedLoadedAt["Validated loaded_at"]
    end
    
    subgraph ProcessingEngines["Processing Engines"]
        modelProcessor["Model Processor"]
        sourceProcessor["Source Processor"] 
        testProcessor["Test Processor"]
    end
    
    validatedDataTests --> modelProcessor
    validatedDataTests --> testProcessor
    validatedExposures --> modelProcessor
    validatedFreshness --> sourceProcessor
    validatedLoadedAt --> sourceProcessor
    validatedLoadedAt --> modelProcessor
    
    modelProcessor --> ProcessedModels["Processed Models"]
    sourceProcessor --> ProcessedSources["Processed Sources"]
    testProcessor --> ProcessedTests["Processed Tests"]
```

Sources: Based on architecture patterns from provided diagrams and change file references

## Recent System Evolution

### Recent Changes

The configuration validation system has undergone several recent improvements:

1. **Adapter Gating Implementation** - Introduction of adapter-specific validation controls
2. **Schema Definition Updates** - Enhanced schema definitions with nested configurations and cloud integration
3. **Deprecation Management** - Conversion of `GenericJSONSchemaValidationDeprecation` to preview status

### Migration Considerations

The system maintains backward compatibility while evolving validation standards:
- Deprecated source overrides are being phased out
- Generic JSON schema validation deprecations provide migration warnings
- Adapter-specific gating allows gradual rollout of new validation rules