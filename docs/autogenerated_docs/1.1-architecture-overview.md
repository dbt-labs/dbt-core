# Architecture Overview

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [.bumpversion.cfg](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.bumpversion.cfg)
- [.changes/README.md](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/README.md)

</details>



## Purpose and Scope

This document provides a high-level overview of dbt-core's system architecture, focusing on the major subsystems and their interactions. It covers the release management pipeline, configuration validation systems, and core processing components that enable dbt's data transformation capabilities.

For detailed information about specific subsystems, see:
- Core execution systems: [Core Execution System](#2)
- Configuration validation: [Configuration Validation and JSON Schema](#3.1)
- Release management details: [Release Process and Version Management](#11.1)
- Changelog automation: [Changelog Automation](#11.2)

## Overall System Architecture

dbt-core is structured as a modular system with distinct layers for release management, configuration validation, data processing, and external integrations.

### High-Level Component Architecture

```mermaid
graph TB
    subgraph "Release Management Layer"
        bumpversion[".bumpversion.cfg<br/>Version Control"]
        changie["changie<br/>Changelog Automation"]
        changes_dir["/.changes/<br/>Change Fragments"]
    end
    
    subgraph "Configuration Layer"
        json_schema["JSON Schema<br/>Validation"]
        dbt_project["dbt_project.yml<br/>Schema"]
        model_config["Model Configuration<br/>Processing"]
    end
    
    subgraph "Core Processing Layer"
        freshness_mgmt["Source/Model<br/>Freshness Management"]
        semantic_layer["Semantic Interfaces<br/>MetricFlow Integration"]
        node_selection["Node Selection<br/>Graph Processing"]
    end
    
    subgraph "Interface Layer"
        cli_system["CLI System<br/>Command Processing"]
        manifest_artifacts["Manifest/Artifacts<br/>Management"]
        testing_framework["Testing Framework<br/>Unit/Generic Tests"]
    end
    
    subgraph "External Dependencies"
        pydantic["pydantic v1/v2<br/>Data Validation"]
        jsonschema_lib["jsonschema 4.19.1+<br/>Schema Validation"]
        dbt_common["dbt-common 1.25.1+<br/>Shared Components"]
    end
    
    bumpversion --> changie
    changie --> changes_dir
    
    json_schema --> dbt_project
    json_schema --> model_config
    
    freshness_mgmt --> semantic_layer
    node_selection --> manifest_artifacts
    
    cli_system --> freshness_mgmt
    cli_system --> node_selection
    testing_framework --> model_config
    
    json_schema --> jsonschema_lib
    model_config --> pydantic
    freshness_mgmt --> dbt_common
```

**Sources:** [.bumpversion.cfg:1-38](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.bumpversion.cfg#L1-L38), [.changes/README.md:1-54](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/README.md#L1-L54)

## Release and Version Management

The release management system uses automated tooling to maintain version consistency and generate documentation.

### Version Management Pipeline

```mermaid
flowchart TD
    dev_change["Developer Change"] --> change_fragment["changie new<br/>/.changes/unreleased/*.yaml"]
    change_fragment --> batch_cmd["changie batch <version>"]
    batch_cmd --> merge_cmd["changie merge"]
    merge_cmd --> changelog["CHANGELOG.md<br/>Generation"]
    
    version_bump["Version Update Needed"] --> bumpversion_cmd["bumpversion"]
    bumpversion_cmd --> setup_py["core/setup.py<br/>Version Update"]
    bumpversion_cmd --> version_py["core/dbt/version.py<br/>Version Update"]
    
    subgraph "Version Components"
        major_minor_patch["major.minor.patch"]
        prerelease["prekind: a|b|rc"]
        prerelease_num["num: numeric"]
        nightly["nightly: dev builds"]
    end
    
    bumpversion_cmd --> major_minor_patch
    bumpversion_cmd --> prerelease
    bumpversion_cmd --> prerelease_num
    bumpversion_cmd --> nightly
    
    changelog --> release["Final Release"]
    setup_py --> release
    version_py --> release
```

The version management system supports semantic versioning with pre-release and nightly build capabilities. The `bumpversion` tool manages version strings across multiple files using a regex pattern that parses version components [.bumpversion.cfg:3-12]().

**Sources:** [.bumpversion.cfg:1-38](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.bumpversion.cfg#L1-L38), [.changes/README.md:13-47](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/README.md#L13-L47)

## Core Processing Systems

The core processing layer handles data transformation, freshness tracking, and semantic layer integration.

### Data Processing Flow

```mermaid
graph LR
    subgraph "Input Processing"
        external_sources["External Data<br/>Sources"]
        source_config["Source<br/>Configuration"]
    end
    
    subgraph "Freshness Management"
        source_freshness["Source Freshness<br/>Tracking"]
        model_freshness["Model Freshness<br/>Tracking"]
        loaded_at_query["loaded_at_query<br/>Processing"]
    end
    
    subgraph "Model Processing" 
        model_parsing["Model SQL<br/>Parsing"]
        model_validation["Configuration<br/>Validation"]
        model_execution["Model<br/>Execution"]
    end
    
    subgraph "Semantic Layer"
        semantic_interfaces["Semantic<br/>Interfaces"]
        metricflow["MetricFlow<br/>Integration"]
        time_spine["Time Spine<br/>Processing"]
    end
    
    external_sources --> source_freshness
    source_config --> source_freshness
    source_freshness --> loaded_at_query
    
    model_parsing --> model_validation
    model_validation --> model_execution
    model_freshness --> loaded_at_query
    
    source_freshness --> semantic_interfaces
    model_execution --> semantic_interfaces
    semantic_interfaces --> metricflow
    metricflow --> time_spine
```

**Sources:** [.changes/README.md:1-54](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/README.md#L1-L54)

## Configuration and Validation Architecture

The configuration system uses JSON schema validation to ensure project consistency and provide structured validation across different configuration types.

### Configuration Validation Flow

```mermaid
graph TB
    subgraph "Configuration Sources"
        dbt_project_yml["dbt_project.yml<br/>Project Schema"]
        model_sql_files["Model SQL Files<br/>Inline Config"]
        source_yaml["Source YAML<br/>Configuration"]
    end
    
    subgraph "Validation Engine"
        json_schema_validator["JSON Schema<br/>Validator"]
        adapter_validation["Adapter-Specific<br/>Validation"]
        deprecation_warnings["Deprecation<br/>Management"]
    end
    
    subgraph "Configuration Types"
        freshness_config["Freshness<br/>Configuration"]
        test_config["Test<br/>Configuration"]
        model_config_props["Model Config<br/>Properties"]
    end
    
    subgraph "Processing Systems"
        model_processor["Model<br/>Processing"]
        source_processor["Source<br/>Processing"]  
        test_processor["Test<br/>Processing"]
    end
    
    dbt_project_yml --> json_schema_validator
    model_sql_files --> json_schema_validator
    source_yaml --> json_schema_validator
    
    json_schema_validator --> adapter_validation
    json_schema_validator --> deprecation_warnings
    
    adapter_validation --> freshness_config
    adapter_validation --> test_config
    adapter_validation --> model_config_props
    
    freshness_config --> source_processor
    test_config --> test_processor
    model_config_props --> model_processor
```

**Sources:** [.changes/README.md:1-54](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/README.md#L1-L54)

## Integration and Dependency Architecture

dbt-core integrates with external dependencies and provides extension points for adapters and plugins.

### Dependency Integration

| Component | Dependency | Version Requirement | Purpose |
|-----------|------------|-------------------|---------|
| Schema Validation | `jsonschema` | 4.19.1+ | JSON schema validation |
| Data Validation | `pydantic` | v1/v2 support | Configuration parsing |
| Shared Components | `dbt-common` | 1.25.1+ | Core utilities |
| Semantic Layer | `dbt-semantic-interfaces` | 0.9.0+ | MetricFlow integration |

### Extension Architecture

```mermaid
graph TD
    subgraph "dbt-core"
        core_engine["Core Engine"]
        adapter_interface["Adapter<br/>Interface"]
        plugin_system["Plugin<br/>System"]
    end
    
    subgraph "External Adapters"
        postgres_adapter["dbt-postgres"]
        snowflake_adapter["dbt-snowflake"] 
        bigquery_adapter["dbt-bigquery"]
        other_adapters["Other<br/>Adapters"]
    end
    
    subgraph "Extensions"
        semantic_layer_ext["Semantic Layer<br/>Extensions"]
        custom_tests["Custom<br/>Tests"]
        macros["Custom<br/>Macros"]
    end
    
    core_engine --> adapter_interface
    adapter_interface --> postgres_adapter
    adapter_interface --> snowflake_adapter
    adapter_interface --> bigquery_adapter
    adapter_interface --> other_adapters
    
    core_engine --> plugin_system
    plugin_system --> semantic_layer_ext
    plugin_system --> custom_tests
    plugin_system --> macros
```

**Sources:** [.changes/README.md:1-54](https://github.com/dbt-labs/dbt-core/blob/64b58ec6/.changes/README.md#L1-L54)